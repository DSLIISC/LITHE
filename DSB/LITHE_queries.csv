Queryid,Rewritten_Query
1," WITH filtered_inventory AS ( SELECT * FROM inventory WHERE inv_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 2001 ) ) , inv AS ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stdev, mean, CASE mean WHEN 0 THEN NULL ELSE stdev/mean END cov FROM ( SELECT w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy, stddev_samp(inv_quantity_on_hand) stdev, avg(inv_quantity_on_hand) mean FROM filtered_inventory, item, warehouse, date_dim WHERE inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk AND inv_date_sk = d_date_sk AND d_year = 2001 AND i_category IN ('Jewelry', 'Sports') AND i_manager_id BETWEEN 0 AND 1000 AND inv_quantity_on_hand BETWEEN 0 AND 1000 GROUP BY w_warehouse_name, w_warehouse_sk, i_item_sk, d_moy ) foo WHERE CASE mean WHEN 0 THEN 0 ELSE stdev/mean END > 1 ) SELECT inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.w_warehouse_sk, inv2.i_item_sk, inv2.d_moy, inv2.mean, inv2.cov FROM inv inv1, inv inv2 WHERE inv1.i_item_sk = inv2.i_item_sk AND inv1.w_warehouse_sk = inv2.w_warehouse_sk AND inv1.d_moy = 8 AND inv2.d_moy = 8 ORDER BY inv1.w_warehouse_sk, inv1.i_item_sk, inv1.d_moy, inv1.mean, inv1.cov, inv2.d_moy, inv2.mean, inv2.cov; "
2," with filtered_store_sales as ( select * from store_sales where ss_sold_date_sk in (select d_date_sk from date_dim where d_year = 1999) and ss_item_sk in (select i_item_sk from item where i_category = 'Music') and ss_store_sk in (select s_store_sk from store where s_state = 'IA') ) select min(i_item_id), min(s_state), min(ss_quantity), min(ss_list_price), min(ss_coupon_amt), min(ss_sales_price), min(ss_item_sk), min(ss_ticket_number) from filtered_store_sales as store_sales, customer_demographics, date_dim, store, item where ss_sold_date_sk = d_date_sk and ss_item_sk = i_item_sk and ss_store_sk = s_store_sk and ss_cdemo_sk = cd_demo_sk and cd_gender = 'F' and cd_marital_status = 'U' and cd_education_status = '2 yr Degree' and d_year = 1999 and s_state = 'IA' and i_category = 'Music'; "
3," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 1999 ) ) SELECT i_brand_id AS brand_id, i_brand AS brand, i_manufact_id, i_manufact, SUM(ss_ext_sales_price) AS ext_price FROM filtered_store_sales AS ss, date_dim, item, customer, customer_address, store WHERE d_date_sk = ss.ss_sold_date_sk AND ss.ss_item_sk = i_item_sk AND ss.ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND ss.ss_store_sk = s_store_sk AND i_category = 'Sports' AND d_year = 1999 AND d_moy = 5 AND SUBSTRING(ca_zip, 1, 5) <> SUBSTRING(s_zip, 1, 5) AND ca_state = 'MD' AND c_birth_month = 12 AND ss_wholesale_cost BETWEEN 0 AND 100 GROUP BY i_brand, i_brand_id, i_manufact_id, i_manufact ORDER BY ext_price DESC, i_brand, i_brand_id, i_manufact_id, i_manufact LIMIT 100; "
4," with sales_data as ( select ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue from store_sales, date_dim where ss_sold_date_sk = d_date_sk and d_month_seq between 1205 and 1205+110 and ss_sales_price / ss_list_price BETWEEN 42 * 0.01 AND 52 * 1 group by ss_store_sk, ss_item_sk ), average_revenue as ( select ss_store_sk, avg(revenue) as ave from sales_data group by ss_store_sk ) select s_store_name, i_item_desc, sc.revenue, i_current_price, i_wholesale_cost, i_brand from store, item, average_revenue sb, sales_data sc where sb.ss_store_sk = sc.ss_store_sk and sc.revenue <= 100 * sb.ave and s_store_sk = sc.ss_store_sk and i_item_sk = sc.ss_item_sk and i_manager_id BETWEEN 0 and 100 and s_state in ('TN','KY','MO') order by s_store_name, i_item_desc limit 100; "
5," WITH date_filter AS ( SELECT d_date_sk, d_moy FROM date_dim WHERE (d_moy = 3 AND d_year = 2000) OR (d_moy BETWEEN 3 AND 5 AND d_year = 2000) ), sales_data AS ( SELECT ss.ss_item_sk, ss.ss_customer_sk, ss.ss_ticket_number, ss.ss_net_profit, sr.sr_net_loss, sr.sr_returned_date_sk, cs.cs_net_profit, cs.cs_sold_date_sk, cs.cs_order_number FROM store_sales ss JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN catalog_sales cs ON sr.sr_customer_sk = cs.cs_bill_customer_sk AND sr.sr_item_sk = cs.cs_item_sk WHERE ss.ss_sold_date_sk IN ( SELECT d_date_sk FROM date_filter WHERE d_moy = 3 ) AND sr.sr_returned_date_sk IN ( SELECT d_date_sk FROM date_filter WHERE d_moy BETWEEN 3 AND 5 ) AND cs.cs_sold_date_sk IN ( SELECT d_date_sk FROM date_filter WHERE d_moy BETWEEN 3 AND 5 ) ) SELECT MIN(i.i_item_id) AS min_item_id, MIN(i.i_item_desc) AS min_item_desc, MIN(s.s_store_id) AS min_store_id, MIN(s.s_store_name) AS min_store_name, MIN(sd.ss_net_profit) AS min_ss_net_profit, MIN(sd.sr_net_loss) AS min_sr_net_loss, MIN(sd.cs_net_profit) AS min_cs_net_profit, MIN(sd.ss_item_sk) AS min_ss_item_sk, MIN(sd.ss_ticket_number) AS min_sr_ticket_number, MIN(sd.cs_order_number) AS min_cs_order_number FROM sales_data sd JOIN item i ON i.i_item_sk = sd.ss_item_sk JOIN store s ON s.s_store_sk = sd.cs_sold_date_sk; "
6," WITH filtered_catalog_returns AS ( SELECT * FROM catalog_returns WHERE cr_returned_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 2000 ) ), customer_total_return AS ( SELECT cr_returning_customer_sk AS ctr_customer_sk, ca_state AS ctr_state, SUM(cr_return_amt_inc_tax) AS ctr_total_return FROM filtered_catalog_returns, date_dim, customer_address WHERE cr_returned_date_sk = d_date_sk AND d_year = 2000 AND cr_returning_addr_sk = ca_address_sk GROUP BY cr_returning_customer_sk, ca_state ) SELECT c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return FROM customer_total_return ctr1, customer_address, customer WHERE ctr1.ctr_total_return > ( SELECT AVG(ctr_total_return) * 1.2 FROM customer_total_return ctr2 WHERE ctr1.ctr_state = ctr2.ctr_state ) AND ca_address_sk = c_current_addr_sk AND ca_state = 'IN' AND ctr1.ctr_customer_sk = c_customer_sk ORDER BY c_customer_id, c_salutation, c_first_name, c_last_name, ca_street_number, ca_street_name, ca_street_type, ca_suite_number, ca_city, ca_county, ca_state, ca_zip, ca_country, ca_gmt_offset, ca_location_type, ctr_total_return LIMIT 100; "
7," with filtered_catalog_sales as ( select * from catalog_sales where cs_sold_date_sk in (select d_date_sk from date_dim where d_year = 2001) and cs_wholesale_cost BETWEEN 95 AND 100 and cs_item_sk in (select i_item_sk from item where i_category = 'Electronics') ) select min(i_item_id), min(ca_country), min(ca_state), min(ca_county), min(cs_quantity), min(cs_list_price), min(cs_coupon_amt), min(cs_sales_price), min(cs_net_profit), min(c_birth_year), min(cd_dep_count) from filtered_catalog_sales as catalog, customer_demographics, customer, customer_address, date_dim, item where cs_sold_date_sk = d_date_sk and cs_item_sk = i_item_sk and cs_bill_cdemo_sk = cd_demo_sk and cs_bill_customer_sk = c_customer_sk and cd_gender = 'M' and cd_education_status = 'Advanced Degree' and c_current_addr_sk = ca_address_sk and d_year = 2001 and c_birth_month = 8 and ca_state in ('IN', 'MT', 'TX') and i_category = 'Electronics'; "
8," WITH filtered_catalog_sales AS ( SELECT * FROM catalog_sales WHERE cs_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_date BETWEEN (CAST('2000-06-01' AS date) - INTERVAL '30 day') AND (CAST('2000-06-01' AS date) + INTERVAL '30 day') ) ) SELECT w_state, i_item_id, SUM(CASE WHEN (CAST(d_date AS date) < CAST('2000-04-09' AS date)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_before, SUM(CASE WHEN (CAST(d_date AS date) >= CAST('2000-04-09' AS date)) THEN cs_sales_price - COALESCE(cr_refunded_cash, 0) ELSE 0 END) AS sales_after FROM filtered_catalog_sales LEFT OUTER JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk), warehouse, item, date_dim WHERE i_item_sk = cs_item_sk AND cs_warehouse_sk = w_warehouse_sk AND cs_sold_date_sk = d_date_sk AND d_date BETWEEN (CAST('2000-06-01' AS date) - INTERVAL '30 day') AND (CAST('2000-06-01' AS date) + INTERVAL '30 day') AND i_category = 'Women' AND i_manager_id BETWEEN 0 AND 1000 AND cs_wholesale_cost BETWEEN 0 AND 1000 AND cr_reason_sk = 23 GROUP BY w_state, i_item_id ORDER BY w_state, i_item_id LIMIT 100; "
9," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 2001 ) ) SELECT AVG(ss_quantity), AVG(ss_ext_sales_price), AVG(ss_ext_wholesale_cost), SUM(ss_ext_wholesale_cost) FROM filtered_store_sales AS ss, store, customer_demographics AS cd, household_demographics AS hd, customer_address AS ca, date_dim AS d WHERE s_store_sk = ss.ss_store_sk AND ss.ss_sold_date_sk = d.d_date_sk AND d.d_year = 2001 AND ( (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'U' AND cd.cd_education_status = 'Advanced Degree' AND ss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd.hd_dep_count = 3) OR (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'U' AND cd.cd_education_status = '4 yr Degree' AND ss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd.hd_dep_count = 1) OR (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'S' AND cd.cd_education_status = 'Advanced Degree' AND ss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd.hd_dep_count = 1) ) AND ( (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('NC', 'TN', 'WI') AND ss.ss_net_profit BETWEEN 100 AND 200) OR (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('GA', 'KY', 'LA') AND ss.ss_net_profit BETWEEN 150 AND 300) OR (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('AL', 'MN', 'TN') AND ss.ss_net_profit BETWEEN 50 AND 250) ); "
10," WITH filtered_catalog_sales AS ( SELECT * FROM catalog_sales WHERE cs_ship_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1178 AND 1178 + 23 ) AND cs_list_price BETWEEN 24 AND 53 ) SELECT substring(w_warehouse_name, 1, 20), sm_type, cc_name, SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk <= 30) THEN 1 ELSE 0 END) AS ""30 days"", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 30) AND (cs_ship_date_sk - cs_sold_date_sk <= 60) THEN 1 ELSE 0 END) AS ""31-60 days"", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 60) AND (cs_ship_date_sk - cs_sold_date_sk <= 90) THEN 1 ELSE 0 END) AS ""61-90 days"", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 90) AND (cs_ship_date_sk - cs_sold_date_sk <= 120) THEN 1 ELSE 0 END) AS ""91-120 days"", SUM(CASE WHEN (cs_ship_date_sk - cs_sold_date_sk > 120) THEN 1 ELSE 0 END) AS "">120 days"" FROM filtered_catalog_sales AS cs JOIN warehouse AS w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN ship_mode AS sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center AS cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN date_dim AS d ON cs.cs_ship_date_sk = d.d_date_sk WHERE d.d_month_seq BETWEEN 1178 AND 1178 + 23 AND sm.sm_type = 'LIBRARY' AND cc.cc_class = 'large' AND w.w_gmt_offset = -5 GROUP BY substring(w_warehouse_name, 1, 20), sm_type, cc_name ORDER BY substring(w_warehouse_name, 1, 20), sm_type, cc_name LIMIT 100; "
11," with filtered_catalog_sales as ( select * from catalog_sales where cs_ship_date_sk in ( select d_date_sk from date_dim where d_month_seq between 1185 and 1185 + 23 ) and cs_call_center_sk in ( select cc_call_center_sk from call_center where cc_class = 'large' ) ) select min(w_warehouse_name), min(sm_type), min(cc_name), min(cs_order_number), min(cs_item_sk) from filtered_catalog_sales as cs, warehouse, ship_mode, call_center, date_dim where cs_ship_date_sk = d_date_sk and cs_warehouse_sk = w_warehouse_sk and cs_ship_mode_sk = sm_ship_mode_sk and cs_call_center_sk = cc_call_center_sk and cs_list_price between 136 and 165 and sm_type = 'EXPRESS' and cc_class = 'large' and w_gmt_offset = -5 and cs_ship_date_sk in ( select d_date_sk from date_dim where d_month_seq between 1185 and 1185 + 23 ); "
12," SELECT COUNT(*) FROM ( SELECT DISTINCT c.c_last_name, c.c_first_name, d.d_date FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE d.d_month_seq BETWEEN 1209 AND 1220 AND ss.ss_list_price BETWEEN 271 AND 300 AND c.c_birth_year BETWEEN 1942 AND 1948 AND ss.ss_wholesale_cost BETWEEN 38 AND 48 AND NOT EXISTS ( SELECT 1 FROM catalog_sales cs WHERE cs.cs_sold_date_sk = d.d_date_sk AND cs.cs_bill_customer_sk = c.c_customer_sk AND cs.cs_list_price BETWEEN 271 AND 300 AND cs.cs_wholesale_cost BETWEEN 38 AND 48 ) AND NOT EXISTS ( SELECT 1 FROM web_sales ws WHERE ws.ws_sold_date_sk = d.d_date_sk AND ws.ws_bill_customer_sk = c.c_customer_sk AND ws.ws_list_price BETWEEN 271 AND 300 AND ws.ws_wholesale_cost BETWEEN 38 AND 48 ) ) AS cool_cust; "
13," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 2001 ) ) SELECT MIN(ss_quantity), MIN(ss_ext_sales_price), MIN(ss_ext_wholesale_cost), MIN(ss_ext_wholesale_cost) FROM filtered_store_sales AS ss, store, customer_demographics AS cd, household_demographics AS hd, customer_address AS ca, date_dim AS d WHERE s_store_sk = ss.ss_store_sk AND ss.ss_sold_date_sk = d.d_date_sk AND d.d_year = 2001 AND ( (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'W' AND cd.cd_education_status = 'College' AND ss.ss_sales_price BETWEEN 100.00 AND 150.00 AND hd.hd_dep_count = 3) OR (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'College' AND ss.ss_sales_price BETWEEN 50.00 AND 100.00 AND hd.hd_dep_count = 1) OR (ss.ss_hdemo_sk = hd.hd_demo_sk AND cd.cd_demo_sk = ss.ss_cdemo_sk AND cd.cd_marital_status = 'D' AND cd.cd_education_status = 'Unknown' AND ss.ss_sales_price BETWEEN 150.00 AND 200.00 AND hd.hd_dep_count = 1) ) AND ( (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('IA', 'MN', 'VA') AND ss.ss_net_profit BETWEEN 100 AND 200) OR (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('AL', 'OH', 'OR') AND ss.ss_net_profit BETWEEN 150 AND 300) OR (ss.ss_addr_sk = ca.ca_address_sk AND ca.ca_country = 'United States' AND ca.ca_state IN ('AR', 'AZ', 'WY') AND ss.ss_net_profit BETWEEN 50 AND 250) ); "
14," with filtered_store_sales as ( select * from store_sales where ss_sold_date_sk in (select d_date_sk from date_dim where d_year = 2002) and ss_item_sk in (select i_item_sk from item where i_category = 'Books') ) select i_item_id, s_state, grouping(s_state) g_state, avg(ss_quantity) agg1, avg(ss_list_price) agg2, avg(ss_coupon_amt) agg3, avg(ss_sales_price) agg4 from filtered_store_sales as store_sales, customer_demographics, date_dim, store, item where ss_sold_date_sk = d_date_sk and ss_item_sk = i_item_sk and ss_store_sk = s_store_sk and ss_cdemo_sk = cd_demo_sk and cd_gender = 'F' and cd_marital_status = 'W' and cd_education_status = 'College' and d_year = 2002 and s_state = 'NE' and i_category = 'Books' group by rollup (i_item_id, s_state) order by i_item_id, s_state limit 100; "
15," with filtered_store_sales as ( select * from store_sales where ss_sold_date_sk in ( select d_date_sk from date_dim where d_dow = 2 ) ), filtered_store_returns as ( select * from store_returns where sr_returned_date_sk in ( select d_date_sk from date_dim where d_moy = 5 ) ) select min(s_store_name), min(s_company_id), min(s_street_number), min(s_street_name), min(s_suite_number), min(s_city), min(s_zip), min(ss_ticket_number), min(ss_sold_date_sk), min(sr_returned_date_sk), min(ss_item_sk), min(d1.d_date_sk) from filtered_store_sales as ss, filtered_store_returns as sr, store, date_dim d1, date_dim d2 where d2.d_moy = 5 and ss_ticket_number = sr_ticket_number and ss_item_sk = sr_item_sk and ss_sold_date_sk = d1.d_date_sk and sr_returned_date_sk = d2.d_date_sk and ss_customer_sk = sr_customer_sk and ss_store_sk = s_store_sk and sr_store_sk = s_store_sk and d1.d_date between (d2.d_date - interval '120 day') and d2.d_date and d1.d_dow = 2 and s_state in ('AR','IL','TX'); "
16," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1223 AND 1223 + 11 ) ), filtered_catalog_sales AS ( SELECT * FROM catalog_sales WHERE cs_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1223 AND 1223 + 11 ) ), filtered_web_sales AS ( SELECT * FROM web_sales WHERE ws_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_month_seq BETWEEN 1223 AND 1223 + 11 ) ) SELECT COUNT(*) FROM ( SELECT DISTINCT c_last_name, c_first_name, d_date FROM filtered_store_sales, date_dim, customer WHERE filtered_store_sales.ss_sold_date_sk = date_dim.d_date_sk AND filtered_store_sales.ss_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1223 AND 1223 + 11 AND c_birth_month IN (5, 7, 10, 12) AND ss_list_price BETWEEN 111 AND 170 AND ss_wholesale_cost BETWEEN 78 AND 98 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM filtered_catalog_sales, date_dim, customer WHERE filtered_catalog_sales.cs_sold_date_sk = date_dim.d_date_sk AND filtered_catalog_sales.cs_bill_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1223 AND 1223 + 11 AND c_birth_month IN (5, 7, 10, 12) AND cs_list_price BETWEEN 111 AND 170 AND cs_wholesale_cost BETWEEN 78 AND 98 INTERSECT SELECT DISTINCT c_last_name, c_first_name, d_date FROM filtered_web_sales, date_dim, customer WHERE filtered_web_sales.ws_sold_date_sk = date_dim.d_date_sk AND filtered_web_sales.ws_bill_customer_sk = customer.c_customer_sk AND d_month_seq BETWEEN 1223 AND 1223 + 11 AND c_birth_month IN (5, 7, 10, 12) AND ws_list_price BETWEEN 111 AND 170 AND ws_wholesale_cost BETWEEN 78 AND 98 ) hot_cust LIMIT 100; "
17," with filtered_store_sales as ( select * from store_sales where ss_sold_date_sk in ( select d_date_sk from date_dim where d_year = 1999 ) and ss_item_sk in ( select i_item_sk from item where i_category IN ('Home', 'Jewelry', 'Women') and i_manager_id BETWEEN 6 and 25 ) and ss_wholesale_cost BETWEEN 2 AND 12 ), frequent_ss_items as ( select substring(i_item_desc,1,30) itemdesc, i_item_sk item_sk, d_date solddate, count(*) cnt from filtered_store_sales, date_dim, item where ss_sold_date_sk = d_date_sk and ss_item_sk = i_item_sk and d_year = 1999 and i_manager_id BETWEEN 6 and 25 AND i_category IN ('Home', 'Jewelry', 'Women') group by substring(i_item_desc,1,30), i_item_sk, d_date having count(*) > 4 ), max_store_sales as ( select max(csales) tpcds_cmax from ( select c_customer_sk, sum(ss_quantity * ss_sales_price) csales from filtered_store_sales, customer, date_dim where ss_customer_sk = c_customer_sk and ss_sold_date_sk = d_date_sk and d_year = 1999 and ss_wholesale_cost BETWEEN 2 AND 12 group by c_customer_sk ) tmp1 ), best_ss_customer as ( select c_customer_sk, sum(ss_quantity * ss_sales_price) ssales from filtered_store_sales, customer where ss_customer_sk = c_customer_sk and c_birth_year BETWEEN 1929 AND 1935 group by c_customer_sk having sum(ss_quantity * ss_sales_price) > (95/100.0) * (select * from max_store_sales) ) select sum(sales) from ( select cs_quantity * cs_list_price sales from catalog_sales, date_dim where d_year = 1999 and d_moy = 2 and cs_sold_date_sk = d_date_sk and cs_item_sk in (select item_sk from frequent_ss_items) and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer) and cs_wholesale_cost BETWEEN 2 AND 12 union all select ws_quantity * ws_list_price sales from web_sales, date_dim where d_year = 1999 and d_moy = 2 and ws_sold_date_sk = d_date_sk and ws_item_sk in (select item_sk from frequent_ss_items) and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer) and ws_wholesale_cost BETWEEN 2 AND 12 ) tmp2 limit 100; "
18," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 1999 ) ), filtered_web_sales AS ( SELECT * FROM web_sales WHERE ws_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 1999 ) ) SELECT MIN(ss.ss_item_sk), MIN(ss.ss_ticket_number), MIN(ws.ws_order_number), MIN(c.c_customer_sk), MIN(cd.cd_demo_sk), MIN(hd.hd_demo_sk) FROM filtered_store_sales ss JOIN filtered_web_sales ws ON ss.ss_item_sk = ws.ws_item_sk JOIN date_dim d1 ON ss.ss_sold_date_sk = d1.d_date_sk JOIN date_dim d2 ON ws.ws_sold_date_sk = d2.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk AND ws.ws_bill_customer_sk = c.c_customer_sk JOIN inventory inv ON inv.inv_item_sk = ss.ss_item_sk AND inv.inv_date_sk = ss.ss_sold_date_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN store s ON s.s_state = w.w_state JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE inv.inv_quantity_on_hand >= ss.ss_quantity AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '30 day') AND i.i_category IN ('Children', 'Jewelry', 'Music') AND i.i_manager_id IN (7, 11, 33, 42, 54, 64, 66, 75, 79, 93) AND ca.ca_state IN ('IL', 'MI', 'MN', 'MS', 'NE') AND d1.d_year = 1999 AND ws.ws_wholesale_cost BETWEEN 80 AND 100; "
19," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_list_price BETWEEN 33 * 0.01 AND 53 * 0.01 ), filtered_store_returns AS ( SELECT * FROM store_returns WHERE sr_returned_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2000) ), filtered_web_sales AS ( SELECT * FROM web_sales WHERE ws_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2000) ) SELECT min(c_customer_sk), min(ss_item_sk), min(sr_ticket_number), min(ws_order_number) FROM filtered_store_sales ss, filtered_store_returns sr, filtered_web_sales ws, date_dim d1, date_dim d2, item, customer, customer_address, household_demographics WHERE ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_customer_sk = ws.ws_bill_customer_sk AND ss.ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND c_current_hdemo_sk = hd_demo_sk AND ss.ss_item_sk = sr.sr_item_sk AND sr.sr_item_sk = ws.ws_item_sk AND i_item_sk = ss.ss_item_sk AND i_category IN ('Men', 'Shoes', 'Women') AND sr.sr_returned_date_sk = d1.d_date_sk AND ws.ws_sold_date_sk = d2.d_date_sk AND d2.d_date BETWEEN d1.d_date AND (d1.d_date + INTERVAL '90 day') AND ca_state IN ('IN', 'KY', 'SD', 'TX', 'VA') AND d1.d_year = 2000 AND hd_income_band_sk BETWEEN 6 AND 12 AND hd_buy_potential = '5001-10000' AND ss.ss_list_price BETWEEN 33 * 0.01 AND 53 * 0.01; "
20," WITH filtered_store_sales AS ( SELECT * FROM store_sales WHERE ss_sold_date_sk IN ( SELECT d_date_sk FROM date_dim WHERE d_year = 2001 ) ) SELECT MIN(i_brand_id), MIN(i_manufact_id), MIN(ss_ext_sales_price) FROM filtered_store_sales, date_dim, item, customer, customer_address, store WHERE d_date_sk = ss_sold_date_sk AND ss_item_sk = i_item_sk AND ss_customer_sk = c_customer_sk AND c_current_addr_sk = ca_address_sk AND ss_store_sk = s_store_sk AND i_category = 'Children' AND d_year = 2001 AND d_moy = 11 AND substring(ca_zip, 1, 5) <> substring(s_zip, 1, 5) AND ca_state = 'VA' AND c_birth_month = 11 AND ss_wholesale_cost BETWEEN 28 AND 48; "
